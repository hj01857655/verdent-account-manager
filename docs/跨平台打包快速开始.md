# 跨平台打包快速开始

## 🎯 目标

使用 GitHub Actions 自动构建 Windows、macOS 和 Linux 三个平台的安装包。

## ⚡ 快速开始（3 步）

### 步骤 1: 运行设置脚本

```powershell
.\setup_github_actions.ps1
```

这个脚本会：
- ✅ 检查并修正图标文件名
- ✅ 验证所有必需的配置文件
- ✅ 检查 Git 配置
- ✅ 显示下一步操作

### 步骤 2: 推送到 GitHub

```bash
# 提交所有更改
git add .
git commit -m "Setup GitHub Actions for cross-platform builds"

# 推送到 GitHub
git push origin main
```

### 步骤 3: 触发构建

**方式 A: 创建版本标签（推荐）**
```bash
git tag v1.0.0
git push origin v1.0.0
```

**方式 B: 手动触发**
1. 访问 GitHub 仓库
2. 点击 **Actions** 标签
3. 选择 **Build and Release**
4. 点击 **Run workflow**

## 📦 构建产物

构建完成后，在 Actions 页面下载：

| 平台 | 安装包格式 |
|------|-----------|
| Windows | `.msi`、`.exe` |
| macOS | `.dmg`、`.app` |
| Linux | `.deb`、`.AppImage` |

## 📝 文件清单

```
.github/
  └── workflows/
      └── build.yml              # GitHub Actions 工作流配置

Verdent_account_manger/
  └── src-tauri/
      ├── tauri.conf.json       # 已更新：支持所有平台
      └── icons/
          ├── 32x32.png          # ✓ 必需
          ├── 128x128.png        # ✓ 必需
          ├── 128x128@2x.png     # ✓ 必需
          ├── icon.icns          # ✓ 必需 (macOS)
          └── icon.ico           # ✓ 必需 (Windows)

docs/
  ├── 跨平台打包快速开始.md      # 本文件
  └── GitHub_Actions_跨平台打包指南.md  # 详细文档
```

## 🔍 验证

### 1. 检查配置文件

**tauri.conf.json**
```json
{
  "bundle": {
    "targets": "all",  // ← 应该是 "all"
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/128x128@2x.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ]
  }
}
```

### 2. 检查工作流文件

确认 `.github/workflows/build.yml` 存在且包含：
```yaml
matrix:
  include:
    - platform: windows-latest
    - platform: macos-latest
    - platform: ubuntu-22.04
```

### 3. 检查图标文件

运行命令验证：
```powershell
Get-ChildItem Verdent_account_manger\src-tauri\icons
```

应该看到正确的文件名（使用 `x` 不是 `×`）

## ⏱️ 构建时间

- **首次构建**: 约 15-30 分钟（需要下载和缓存依赖）
- **后续构建**: 约 5-10 分钟（使用缓存）

## 🐛 常见问题

### Q: 构建失败显示找不到图标文件

**A:** 运行 `.\setup_github_actions.ps1` 修正图标文件名

### Q: 如何只构建特定平台？

**A:** 编辑 `.github/workflows/build.yml`，注释掉不需要的平台

### Q: macOS 构建显示签名错误

**A:** 工作流已配置跳过签名，如需签名请参考详细文档

### Q: 如何查看构建日志？

**A:** GitHub 仓库 → Actions → 点击具体的运行记录

## 📚 相关文档

- **详细配置**: [docs/GitHub_Actions_跨平台打包指南.md](./GitHub_Actions_跨平台打包指南.md)
- **Tauri 官方文档**: https://tauri.app/v1/guides/
- **GitHub Actions 文档**: https://docs.github.com/actions

## 💡 提示

✅ **首次使用建议**：先手动触发工作流测试，确保一切正常后再使用标签自动触发

✅ **版本号规范**：使用语义化版本（v主版本.次版本.修订号），如 v1.0.0

✅ **测试充分**：在本地测试通过后再推送到 GitHub

## 🎉 完成

现在你已经设置好了跨平台自动构建！每次推送版本标签时，GitHub Actions 会自动构建所有平台的安装包。

---

**需要帮助？** 查看详细文档或提交 Issue。
