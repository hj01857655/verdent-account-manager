# 跨平台打包方案对比

## 方案概览

| 方案 | Windows | macOS | Linux | 难度 | 推荐度 |
|------|---------|-------|-------|------|--------|
| GitHub Actions | ✅ | ✅ | ✅ | ⭐ 简单 | ⭐⭐⭐⭐⭐ |
| 本地打包 | ✅ | ❌ | ❌ | ⭐⭐ 中等 | ⭐⭐ |
| 虚拟机/双系统 | ✅ | ✅ | ✅ | ⭐⭐⭐⭐ 复杂 | ⭐⭐ |
| 交叉编译 | ✅ | ⚠️ 有限 | ⚠️ 有限 | ⭐⭐⭐⭐⭐ 很复杂 | ⭐ |

## 方案 1: GitHub Actions（推荐）✨

### 优点
✅ **完全自动化** - 推送标签即可触发构建  
✅ **免费额度充足** - 公共仓库无限制，私有仓库 2000 分钟/月  
✅ **原生环境** - 在真实的 macOS、Linux 系统上构建  
✅ **无需本地配置** - 不需要安装多个操作系统  
✅ **自动发布** - 构建完成自动创建 Release  
✅ **缓存优化** - 依赖缓存加速后续构建  
✅ **并行构建** - 三个平台同时构建，节省时间  

### 缺点
❌ 首次构建较慢（15-30分钟）  
❌ 需要 GitHub 账号  
❌ 网络问题可能影响构建（但可重试）  

### 适用场景
- ✅ 项目托管在 GitHub
- ✅ 需要定期发布新版本
- ✅ 团队协作开发
- ✅ 希望自动化 CI/CD

### 成本
- 公共仓库：**完全免费**
- 私有仓库：2000 分钟/月免费，超出 $0.008/分钟

### 设置步骤
1. 运行 `.\setup_github_actions.ps1`
2. 推送代码到 GitHub
3. 创建版本标签触发构建

详见：[GitHub_Actions_跨平台打包指南.md](./GitHub_Actions_跨平台打包指南.md)

---

## 方案 2: 本地打包（当前方式）

### 优点
✅ 完全本地控制  
✅ 快速迭代测试  
✅ 无需网络  
✅ 无第三方依赖  

### 缺点
❌ **只能打包当前系统** - Windows 只能打 Windows  
❌ 需要手动管理依赖  
❌ 需要手动分发  
❌ 无法构建其他平台  

### 适用场景
- ✅ 开发测试阶段
- ✅ 只需要 Windows 版本
- ✅ 不想使用云服务

### 成本
**免费** - 使用本地资源

### 当前配置
```json
{
  "bundle": {
    "targets": ["msi", "nsis"]  // 仅 Windows
  }
}
```

---

## 方案 3: 虚拟机/双系统

### 优点
✅ 完全控制构建环境  
✅ 可以本地调试  
✅ 无需依赖云服务  

### 缺点
❌ **硬件要求高** - 需要大量磁盘和内存  
❌ **配置复杂** - 需要安装配置多个系统  
❌ **维护成本高** - 每个系统都要更新维护  
❌ **构建慢** - 需要逐个系统切换构建  
❌ **macOS 虚拟化限制** - 需要 Mac 硬件或特殊设置  

### 硬件需求
- **macOS 虚拟机**: 
  - 需要 Intel Mac 或使用 Hackintosh（违反许可协议）
  - 至少 8GB RAM，50GB 磁盘空间
  
- **Linux 虚拟机**:
  - 4GB RAM，20GB 磁盘空间
  - 可以在 Windows 上使用 WSL2 或 VirtualBox

### 适用场景
- ✅ 有多台物理设备
- ✅ 需要频繁调试不同平台
- ✅ 对构建环境要求严格

### 成本
- 软件：免费（VirtualBox、UTM）或付费（VMware、Parallels）
- macOS：需要 Mac 硬件（$1000+）

---

## 方案 4: 交叉编译

### 原理
在一个平台上编译出其他平台的可执行文件。

### 理论可行性
| 源平台 → 目标平台 | Windows | macOS | Linux |
|------------------|---------|-------|-------|
| **Windows** | ✅ | ❌ | ⚠️ 有限 |
| **macOS** | ⚠️ 有限 | ✅ | ⚠️ 有限 |
| **Linux** | ⚠️ 有限 | ❌ | ✅ |

### Windows → Linux 交叉编译

**理论上可行，但实践中困难重重：**

```powershell
# 安装 Linux 目标
rustup target add x86_64-unknown-linux-gnu

# 尝试构建（通常会失败）
cargo build --target x86_64-unknown-linux-gnu
```

**主要问题：**
❌ 需要 Linux 系统库（如 glibc、gtk）  
❌ Tauri 依赖 WebKit，Windows 上没有  
❌ 需要安装复杂的交叉编译工具链  
❌ 可能遇到各种链接错误  

### macOS 交叉编译

**几乎不可行：**
❌ Apple 不允许在非 Mac 设备上构建 macOS 应用  
❌ 需要 Xcode 工具链（仅限 macOS）  
❌ 需要代码签名（需要 Apple 开发者账号）  

### 适用场景
❌ **不推荐** - 配置复杂，成功率低，维护困难

### 成本
- 时间成本：极高（可能需要数天调试）
- 成功率：很低

---

## 推荐方案对比

### 个人开发者
**推荐**: GitHub Actions ⭐⭐⭐⭐⭐
- 免费、简单、自动化
- 适合快速迭代和发布

**备选**: 本地打包 ⭐⭐⭐
- 开发测试阶段使用
- 只需 Windows 版本时使用

### 团队开发
**推荐**: GitHub Actions ⭐⭐⭐⭐⭐
- CI/CD 集成
- 团队成员都能触发构建
- 自动化测试和发布

### 企业级应用
**推荐**: GitHub Actions + 自建 Runner ⭐⭐⭐⭐⭐
- 私有 Runner 提供更多控制
- 可以使用内网资源
- 符合安全合规要求

---

## 决策流程图

```
需要跨平台打包？
  ├─ 是 → 有 GitHub 账号？
  │       ├─ 是 → 使用 GitHub Actions ✅
  │       └─ 否 → 
  │             ├─ 愿意注册？
  │             │   ├─ 是 → 使用 GitHub Actions ✅
  │             │   └─ 否 → 
  │             │         ├─ 有多台设备？
  │             │         │   ├─ 是 → 使用虚拟机方案 ⚠️
  │             │         │   └─ 否 → 考虑只发布当前平台 ⚠️
  │             └─ 不想用云？→ 虚拟机方案 ⚠️
  │
  └─ 否 → 只需 Windows？
          ├─ 是 → 本地打包 ✅
          └─ 否 → 重新考虑需求

✅ = 推荐
⚠️ = 不推荐但可行
❌ = 不推荐
```

---

## 成本对比（私有项目）

| 方案 | 初始成本 | 月度成本 | 时间成本 |
|------|---------|---------|---------|
| GitHub Actions | $0 | $0-20 | 极低 |
| 本地打包 | $0 | $0 | 低 |
| 虚拟机（云） | $0-100 | $20-100 | 中 |
| 虚拟机（本地） | $1000+ | $0 | 高 |
| 交叉编译 | $0 | $0 | 极高 |

---

## 最终建议

### 🥇 首选: GitHub Actions
**理由**: 
- 配置一次，永久使用
- 完全自动化
- 支持所有平台
- 免费额度充足
- 社区支持好

### 🥈 备选: 本地打包 + GitHub Actions 混合
**方案**:
- 开发测试：本地打包 Windows 版本
- 正式发布：GitHub Actions 构建所有平台

### 🥉 不推荐: 其他方案
除非有特殊需求，否则不建议使用虚拟机或交叉编译方案。

---

## 快速开始

选择了 GitHub Actions？查看：
- [跨平台打包快速开始.md](./跨平台打包快速开始.md)
- [GitHub_Actions_跨平台打包指南.md](./GitHub_Actions_跨平台打包指南.md)

只需要本地打包？查看：
- [BUILD_README.md](../BUILD_README.md)

---

**更新日期**: 2024年11月16日
